---
title: 'Next15+에서 next-mdx-remote 빌드 오류 해결하기'
description: '`ES Module`와 `CommonJS`호환 문제 해결'
date: '2025-09-19'
tags: ['Issue', 'Next.js']
cover: /covers/issue_next-mdx-remote.png
---

# Next15+에서 next-mdx-remote 빌드 오류 해결하기

해당 블로그의 기능 개선을 위해 일반 `.md` 파일 형태에서 `.mdx` 파일 형태로 변경하면서 겪은 문제와 해결과정을 작성합니다.

## 문제의 시작

파일 포멧을 변경하는 과정은 매우 순탄했습니다.

렌더링도 잘 되고 아무 문제 없는듯 보였습니다.

하지만 꺼림칙했던 것이 첫 렌더링에서 계속해서 에러가 발생을 했던 것이였습니다.

```
error TypeError: Cannot read properties of null (reading 'useState')
    at useState (/Users/dprothero/Projects/docs2/node_modules/react/cjs/react.development.js:1622:21)
    at MDXRemote (file:///Users/dprothero/Projects/docs2/node_modules/next-mdx-remote/dist/index.js:40:51)
[snipped]
```

해당 에러를 별 대수롭지 않게 여기고 (이미 기능적으로는 전혀 문제가 없었기 때문에) 마무리 작업을 하고 빌드를 시도했습니다.

하지만..위의 에러 때문에 계속해서 빌드를 실패하게 됩니다.

## 문제

에러를 읽어보면 useState가 null이라는 에러를 볼 수 있는데 저는 MDX 파일이 변환 되어서 렌더링 되는 파일 내에서 useState는

선언 자체를 하지 않았습니다.

문제를 찾던 도중 `next-mdx-remote` 라이브러리에서 렌더링을 해주는 `MDXRemote` 컴포넌트에서 문제가 있음을 발견했습니다.

하지만 라이브러리 컴포넌트를 수정할 수도 없고, 다른 방법이 없어 간단함을 포기하고 next-mdx-remote 라이브러리를 대체할 다른 라이브러리를 찾게 되었습니다.

## 대안 탐색

대안으로 찾은 라이브러리는 @mdx-js/mdx과 @next/mdx였습니다.

사용법을 잘 몰랐기에 우선 GPT에게 일을 시키고, 되는지만 확인해보려 했습니다만...

이 두 라이브러리 또한 제 요구사항을 만족시키기는 어려워보였습니다.

## 문제의 원인 발견!

이것도 잘 안되고, 다른 라이브러리는 요구사항을 충족하지 못하니 방법은 다시 돌아와 오류를 수정하는 것 뿐이였습니다.

막막했지만 계속해서 구글링을 했고(이미 챗GPT께서는 오답을 남발하고 계셨기에...)

어떤 외국 형님이 nextjs의 버전을 `13.4.0`으로 낮추면 해결이 된다는 글을 보게 되었습니다.

하지만 저는 `15.5.0` 버전을 사용하고 있었고, 단순히 버전을 낮추기에는 다른 라이브러리의 버전 또한 맞춰줘야 했기 때문에

그러한 조치는 적절하지 않다고 판단 하였습니다.

어째뜬 버전에 관련된 문제라는 것을 어느정도 판단한 시점에서 호환성 관련한 문제라는 것을 생각하고,

`next-mdx-remote`가 구형 라이브러리라는 것을 가정하여, 구형 라이브러리와 최신 next.js 버전을 어떻게 하면 호환시킬 수 있는지

찾아보게 되었습니다.

## 원인 해결

해당 문제의 원인은 `ES Module`과 `CommonJS`간의 호환성 문제였습니다.

Next.js 15+에서는 ES Module 처리 방식이 이전 버전과 다르게 변경되었는데, `next-mdx-remote` 라이브러리가 내부적으로 React 훅을 사용하면서도 서버 사이드에서 제대로 트랜스파일되지 않아 발생하는 문제였습니다.

서버 환경에서는 React의 `useState`가 정의되지 않은 상태인데, 라이브러리 내부에서 이를 참조하려고 하니 null reference 에러가 발생한 것입니다.

해결방법은 의외로 간단했습니다.

```typescript
// next.config.ts
module.exports = {
    transpilePackages: ['next-mdx-remote'],
};
```

이 설정은 Next.js에게 `next-mdx-remote` 패키지를 명시적으로 트랜스파일하도록 지시한다고 합니다.
이를 통해 `ES Module` 형태의 코드가 서버와 클라이언트 양쪽에서 안전하게 동작할 수 있는 형태로 변환됩니다.

## 왜 이런 일이 생겼을까

Next.js 13부터 도입된 App Router와 함께 패키지 처리 방식이 변경되면서, 일부 라이브러리들이 새로운 빌드 시스템과 완벽하게 호환되지 않는 문제가 발생하고 있습니다.

특히 `next-mdx-remote` 같은 라이브러리는:

-   React 서버 컴포넌트와 클라이언트 컴포넌트 경계에서 동작
-   내부적으로 React 훅을 사용하면서도 서버에서 초기 렌더링이 필요
-   `ES Module`과 `CommonJS`를 혼용하는 구조

이런 복합적인 요인들이 Next.js의 새로운 빌드 시스템과 충돌하면서 문제가 발생한 것입니다.

## 교훈과 마무리

1. **개발 환경의 에러를 무시하지 말자**: 기능이 동작한다고 해서 에러를 방치하면 빌드에서 문제가 될 수 있었습니다.

2. **Next.js 설정의 위력**: `transpilePackages` 하나의 설정으로 많은 호환성 문제를 해결할 수 있었습니다.

결국 몇 시간의 고생 끝에 한 줄 설정으로 해당 이슈를 해결할 수 있었습니다.
