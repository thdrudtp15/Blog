---
 title: 'Next.js의 캐싱 함수'
 description: 'Next.js에서 사용할 수 있는 캐싱 함수에 대해서'
 date: '2025-10-18'
 tags: ['Next.js']
 cover : /covers/nextjs-caching-strategy.png
---

# Next.js에서 제공하는 캐싱 방법에 대해서

Next.js에서 성능 최적화를 위해 제공하는 캐싱 함수인 `unstable_cache`와 `cache` 함수에 대해서 공유합니다.

두 함수는 비슷해보이지만 완전히 다른 방식과 동작을 가집니다.

## unstable_cache 함수

`unstable_cache`함수는 Next.js에서 제공하는 함수로, **요청 간 지속되는 캐시**를 생성합니다.

```tsx
import { unstable_cache } from 'next/cache';

export const getData = unstable_cache(
    async () => {
        const res = await fetch('/api/data');
        return res.json();
    },
    ['data'], // 캐시 키
    {
        revalidate: 3600, // 갱신 시간, 1시간
        tags: ['data'], // 태그 기반 재검증용
    }
);
```

### 특징

-   **수명**: 재검증 시간이 지나거나, revalidateTag() 함수로 무효화 이전 까지는 유지됨.
-   **목적**: 비용이 큰 연산이나, 외부 API 호출의 반환값을 장기간 저장하기 위함.

### 동작 방식

```ts
// 첫 번째 사용자 요청
const products = await getData(); // API 호출 발생

// 두 번째 사용자 요청 (1시간 이내)
const products = await getData(); // 캐시된 결과 반환

// revalidate 시간 경과 후
const products = await getData(); // 새로운 API 호출 발생
```

## cache 함수

`cache`함수는 react에서 제공하는 **중복 호출 방지** 함수입니다.

```ts
import { cache } from 'react';

export const getData = cache(async (id: string) => {
    const res = await fetch(`/api/data/${id}`);
    return res.json();
});
```

### 주요 특징

-   **수명**: 단일요청, 렌더링 동안만 유지 됨.
-   **목적**: 동일한 요청을 중복 호출할 때의 중복 제거

### 동작 방식

```ts
// Layout.tsx
const user = await getData('1'); // DB 호출 발생

// Page.tsx
const user = await getData('1'); // 캐시된 결과 반환 (DB 호출 X)

// Detail.tsx

// 메타데이터 설정을 위한 fetch
const generateMetadata = async () => {
    const result = await getData('1'); // 첫 호출 - DB 호출 발생
    return; //...
};

const Detail = async () => {
    const result = await getData('1'); // 같은 요청 내 - 캐시된 결과 반환
    return; //...
};
```

## 차이점

| 구분       | cache          | unstable_cache                |
| ---------- | -------------- | ----------------------------- |
| **제공**   | React          | Next.js                       |
| **용도**   | 중복 호출 제거 | 데이터 캐싱                   |
| **재검증** | 매 요청마다    | revalidate 옵션으로 제어      |
| **무효화** | X              | revalidateTag, revalidatePath |

## cache와 unstable_cache를 함께 사용하기

두 함수는 함께 사용할 수 있습니다.

```ts
import { cache } from 'react';
import { unstable_cache } from 'next/cache';

// 장기 캐싱
const getData = unstable_cache(
    async () => {
        const res = await fetch('/api/data');
        return res.json();
    },
    ['data'],
    { revalidate: 3600 } // 갱신 시간, 1시간
);

// + 요청 내 중복 제거
export const getProducts = cache(getData);
```

동일한 요청 내에서 중복 호출을 방지할 때는 `cache` 함수를,
요청 간에 데이터를 재사용하고 싶을 경우에는 `unstable_cache` 함수를 사용할 수 있습니다.

적재적소에 사용시 불필요한 서버 요청을 줄여 성능을 개선할 수 있습니다.
